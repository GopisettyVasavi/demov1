<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
<meta charset="utf-8">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<title>Client Company</title>
<meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" type="image/x-icon" href="/renaissance/img/renfavicon.ico">
<!-- CSS here -->
<link rel="stylesheet" href="css/bootstrap.min.css">
<link href="./css/starter-template.css" rel="stylesheet"	media="screen" />
<link href="./css/datatables.min.css" rel="stylesheet" media="screen" />
<link href="css/jquery-ui.css" rel="stylesheet" media="screen" />	
<link href="css/dataTables.jqueryui.min.css" rel="stylesheet" media="screen" />	
<link href="css/dataTables.bootstrap4.min.css" rel="stylesheet" media="screen" />
<link href="css/jquery.dataTables.min.css" rel="stylesheet" media="screen" />	
<link href="css/buttons.dataTables.min.css" rel="stylesheet" media="screen" />	
<link rel="stylesheet" href="css/owl.carousel.min.css">
<link rel="stylesheet" href="css/magnific-popup.css">
<link rel="stylesheet" href="css/font-awesome.min.css">
<link rel="stylesheet" href="css/themify-icons.css">
<link rel="stylesheet" href="css/nice-select.css">
<link rel="stylesheet" href="css/flaticon.css">
<link rel="stylesheet" href="css/gijgo.css">
<link rel="stylesheet" href="css/animate.css">
<link rel="stylesheet" href="css/slicknav.css">
<link rel="stylesheet" href="css/style.css">
<style>
.dropdown {
  display: block;
    width: 100%;
    line-height: 30px;
    border: 1px solid #ccc;
    border-radius: 3px;
    outline: none;
    background: #fcfcff;
    padding: 0 10px;
    font-size: 12px;
    padding-top: 5px;
    padding-bottom: 6px;
}
</style>

<style>
   tr.selected {background-color: #007bff;}
 </style>
 
</head>

<!-- header-start -->
 <header>
            <div class="header-area ">
            <div class="col-xl-3 col-lg-2">
          
			<div class="logo">
				<a href="https://reninfo.com.au/"> <img
					src="img/Renaissance_logo.png" alt="" height="30px" width="150px">

				</a>
				<a   href="#" onclick="window.location = './index' ">Back>></a>
				<a  style="text-align: right;padding-left: 1550px;" href="logout" onclick="cleardata()">Logout</a>
				
				
				
			</div>
			
		</div>
            
            </div>
        </header>
<!-- header-end -->
<!-- bradcam_area  -->
<div class="bradcam_area bradcam_bg_1">
	<div class="container-fluid">
		<div class="row">
			<div class="col-xl-12">
				<div class="bradcam_text">
					<h3>Client Company Details</h3>
				</div>
			</div>
		</div>
	</div>
</div>
<!--/ bradcam_area  -->
<body onload="initialize()">

	<div class="col-lg-12">
		<form class="form-contact contact_form" id="clientlookupform">
<div class="container-fluid" style="border: 1px solid rgba(0, 0, 0, .125); border-radius: .25rem" >
		 	
			
	<table id="company_tbl" class="display">

			</table>
			</div>
			<div class="col-sm-12" style="padding-top: 10px"></div>
			<div class="row">
					<div class="col-sm-4"></div>
					<div class="col-sm-4" >
						<div class="form-group" style="padding-left: 80px">

							<button type="submit" id="btn-save"
								class="button button-contactForm boxed-btn"
								onclick="addnewClient()"  >Add New Client</button>
								
						</div>
					</div>
					</div>
					<div id="hidden" style="display: none">
					<input
								type="text" name="name" placeholder="id"
								class="single-input" id="id" required
								 >
					</div>
<div id="addlookup_div" style="display: none">
			 <div class="container">

				<div class="row">
<div class="col-sm-3">
						<div class="form-group">
							<label for="name" style="font-weight: bold">Company Name *</label> <input
								type="text" name="name" placeholder="Constant Name"
								class="single-input" id="companyname" required
								 >
						</div>
					</div>
					<div class="col-sm-9">
						<div class="form-group">
							<label for="name" style="font-weight: bold">Address</label> 
							<textarea class="form-control w-100" cols="30"
																						rows="2"
																						onfocus="this.placeholder = 'Address'"
																						onblur="this.placeholder = 'Address'"
																						placeholder="Address" id="address"
																						name="Address" ></textarea>
							
							
						</div>
					</div>
					<div class="col-sm-3">
																				<div class="form-group">
							<label for="name" style="font-weight: bold">ABN No</label> <input
								type="text" name="abnno" placeholder="ABN No"
								class="single-input" id="abnno" required
								 >
						</div>
																			</div>
					<div class="col-sm-3">
																				<div class="form-group">
							<label for="name" style="font-weight: bold">Vendor Id</label> <input
								type="text" name="vendorid" placeholder="vendor Id"
								class="single-input" id="vendorid" required
								 >
						</div>
																			</div>
																			
																			<div class="col-sm-3">
																				<div class="form-group">
							<label for="name" style="font-weight: bold">Payment Terms </label> <input
								type="text" name="paymentterm" placeholder="Payment Terms"
								class="single-input" id="paymentterm" required
								 >
						</div>
																			</div>
					
					
		<div class="col-sm-12" style="padding-top: 10px"></div>
					<div class="col-sm-4"></div>
					<div class="col-sm-4">
						<div class="form-group">

							<button type="submit" id="btn-save"
								class="button button-contactForm boxed-btn"
								onclick="clickonsave()">Save</button>
								<button type="submit" id="btn-save"
								class="button button-contactForm boxed-btn"
								onclick="clickonreset()">Reset</button>
								<a href="#" type="submit" id="btn-back"
								class="button button-contactForm boxed-btn"
								onclick="goBack()" style="padding-left: 5px; padding-right: 5px;padding-top: 1px;padding-bottom: 1px">Back</a>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>



	</div>

	</form> 

	<div class="col-sm-12" style="padding-top: 10px"></div>
					
					<div id="feedback" style="padding-left: 400px; color: red"></div>
	</div>

<!-- JS here -->
 <script src="js/vendor/jquery-1.12.4.min.js"></script>
<script src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js" type="text/javascript"></script>
<script src="https://cdn.datatables.net/plug-ins/1.10.20/api/fnFilterClear.js" type="text/javascript"></script>
<script src="https://cdn.datatables.net/searchpanes/1.0.1/js/dataTables.searchPanes.min.js" type="text/javascript"></script>
<script src="https://cdn.datatables.net/select/1.3.1/js/dataTables.select.min.js" type="text/javascript"></script>


<script src="https://cdn.datatables.net/buttons/1.6.1/js/dataTables.buttons.min.js"></script>
<script src="https://cdn.datatables.net/buttons/1.6.1/js/buttons.colVis.min.js"></script>


<script src="js/fixedHeadermin.js" ></script>
	 <script src="js/vendor/modernizr-3.5.0.min.js"></script>
	 <script src="js/vendor/sweetalert2.js"></script>
       
        
        <script src="js/popper.min.js"></script>
        <script src="js/bootstrap.min.js"></script>
        <script src="js/owl.carousel.min.js"></script>
        <script src="js/isotope.pkgd.min.js"></script>
        <script src="js/ajax-form.js"></script>
        <script src="js/waypoints.min.js"></script>
        <script src="js/jquery.counterup.min.js"></script>
        <script src="js/imagesloaded.pkgd.min.js"></script>
        <script src="js/scrollIt.js"></script>
        <script src="js/jquery.scrollUp.min.js"></script>
        <script src="js/wow.min.js"></script>
        <script src="js/nice-select.min.js"></script>
        <script src="js/jquery.slicknav.min.js"></script>
        <script src="js/jquery.magnific-popup.min.js"></script>
        <script src="js/plugins.js"></script>
        <script src="js/gijgo.min.js"></script>
   
        <!--contact js-->
        <script src="js/contact.js"></script>
        <script src="js/jquery.ajaxchimp.min.js"></script>
        <script src="js/jquery.form.js"></script>
        <script src="js/jquery.validate.min.js"></script>
        <script src="js/mail-script.js"></script>
    
        <script src="js/main.js"></script>

	<script type="text/javascript">
	
	
	
	function goBack(){
		//alert('test');
		window.location='./index'

	}
	
	function processValidation(){
		var constantsList=[];
		var table = $('#company_tbl').DataTable();
		table.rows().every( function ( rowIdx, tableLoop, rowLoop ) {
			var d = this.data();
			
			if($("#companyname").val()==d.clientName){
				console.log("Matching company exists..");
				if(($("#paymentterm").val()==d.paymentTerms) &&
						$("#abnno").val()==d.clientAbnNo  &&  $("#address").val()==d.address
						&&  $("#vendorid").val()==d.vendorId )
					$('#feedback').html("Warning: Same data for this Company is already existing. Please enter different values and save.");
				return false;
			}
		    /* var d = this.data();
		    var constantsDTO = {}
		    constantsDTO["constantName"] =d.constantName;
			constantsDTO["constantValue"] = d.constantValue;
			constantsDTO["effectiveFrom"] = d.effectiveFrom;
			constantsDTO["effectiveTill"] = d.effectiveTill;
		   //console.log(commissionDTO);
		   constantsList[i]=constantsDTO;
		   i++; */
		   
		} );
		return true;
	}
	
	function clickonreset(){
		$("#feedback").html("");
		$("#companyname").val("");
		$("#vendorid").val("");
		$("#abnno").val("");
		$("#paymentterm").val("");
		$("#address").val("");
		$("#id").val("");
	}
		function clickonsave() {
			$('#feedback').html("");
			var isValid=true;
			event.preventDefault();
			if($("#companyname").val()=="" ){
				document.getElementById("feedback").style.color = "red";
				$('#feedback').html("Validation error: Company name can not be blank.");
				isValid=false;
				return false;
			}
			var table = $('#company_tbl').DataTable();
			table.rows().every( function ( rowIdx, tableLoop, rowLoop ) {
				var d = this.data();
				
				if($("#companyname").val()==d.companyname){
					console.log("Matching Company exists..");
					if(($("#paymentterm").val()==d.paymentTerms) &&
							$("#abnno").val()==d.clientAbnNo  &&  $("#address").val()==d.address
							&&  $("#vendorid").val()==d.vendorId ){
						$('#feedback').html("Warning: Same data for this constant is already existing. Please enter different values and save.");
					//break;
					isValid=false;
					return false;
					}
					/* else{
						$('#feedback').html("Warning: Constant exists already. Please enter different constant or click on the row to edit data.");
						isValid=false;
						return false;

					} */
				}
			    
			   
			} );
if(isValid){
			var clientCompanyDTO = {}
			clientCompanyDTO["clientName"] = $("#companyname").val();
			clientCompanyDTO["address"] = $("#address").val();
			clientCompanyDTO["paymentTerms"] = $("#paymentterm").val();
			clientCompanyDTO["clientAbnNo"] = $("#abnno").val();
			clientCompanyDTO["vendorId"] = $("#vendorid").val();
			clientCompanyDTO["clientId"] = $("#id").val();
			
			$.ajax({
						type : "POST",
						contentType : "application/json",
						url : "./updateclientcompanies",
						data : JSON.stringify(clientCompanyDTO),
						dataType : 'json',
						cache : false,
						timeout : 600000,
						success : function(data) {
							alert("Company Details saved Successfully.");
							initialize();
						},
						error : function(e) {

							var json = "Response Error:Error occured while updating.<pre>"
									+ e.responseText + "</pre>";
							$('#feedback').html(json);

							console.log("ERROR : ", e);
						}
					});
}
		}

		function initialize() {
			$("#addlookup_div").hide();
			document.getElementById("companyname").focus();
			 $("#id").val("");
			
						$.ajax({
						type : "GET",
						contentType : "application/json",
						url : "./getclientcompanies",
						dataType : 'json',
						cache : false,
						timeout : 600000,
						success : function(data) {
							//var json=data
							var table = $('#company_tbl').DataTable({

								destroy : true,
								searching: false,
								autoWidth : false,
								paging:false,
								buttons : [ 'colvis' ],
								renderer : {
									"header" : "bootstrap"
								},
								
								data : data,
								
								columns : [ 
									 
										
										 {
									"data" : 'clientName',
									"name" : "clientName",
									"title" : "Company Name"
								},
								{
									"data" : 'address',
									"name" : "address",
									"title" : "Address"
								},
								{
									"data" : 'clientAbnNo',
									"name" : "clientAbnNo",
									"title" : "ABN No"
								},
								{
									"data" : 'paymentTerms',
									"name" : "paymentTerms",
									"title" : "Payment Terms"
								},
								{
									"data" : 'vendorId',
									"name" : "vendorId",
									"title" : "Vendor Id"
								},
								{
									"data" : 'clientId',
									"name" : "clientId",
									"title" : "clientId",
									"visible":false
								}]

							});
							$('#company_tbl tfoot tr').appendTo(
									'#company_tbl thead');

							$("#company_tbl tfoot tr").hide();
						},
						error : function(e) {

							var json = "<h4>Response Error:Error occured while loading Company details.</h4><pre>"
									+ e.responseText + "</pre>";
							$('#feedback').html(json);

							console.log("ERROR : ", e);
							

						}
					});

		}
		function addnewClient(){
			event.preventDefault();
			document.getElementById("companyname").focus();

			$("#addlookup_div").show();
			$("#companyname").val("");
			$("#abnno").val("");
			$("#paymentterm").val("");
			$("#vendorid").val("");
			$("#address").val("");
			$("#id").val("");
			document.getElementById("companyname").focus();

		}

		
		$(document).on(
				"click",
				"#company_tbl tbody tr",
				function(e)

				{
					document.getElementById("companyname").focus();
					$('#feedback').html("");
					var table = $('#company_tbl').DataTable();
					$('#company_tbl tbody > tr').removeClass('selected');
					 $(this).addClass('selected');
					var rowData = table.row(this).data();
					// alert('called'+rowData.contractorId);
					$("#addlookup_div").show();
					//var range= rowData.range.split("-");
					$("#companyname").val(rowData.clientName);
					$("#address").val(rowData.address);
					$("#vendorid").val(rowData.vendorId);
					$("#abnno").val(rowData.clientAbnNo);
					$("#paymentterm").val(rowData.paymentTerms);
					
					$("#id").val(rowData.clientId);
					console.log(rowData);
					document.getElementById("companyname").focus();

				});		
	</script>
	<script src="js/idle_timeout.js"></script>
</body>
</html>